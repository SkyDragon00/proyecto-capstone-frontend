{% extends "base.html.j2" %}

{% block title %}Staff{% endblock title %}

{% block head %}
<script src="{{ url_for('static', path='js/staff_operations.js') }}"></script>
{% endblock head %}

{% block header_nav %}
<li>
    <a href="/home">Home</a>
</li>
<li>
    <a href="#">Eventos</a>
</li>
<li>
    <a href="#">Contacto</a>
</li>
{% endblock header_nav %}

{% block main %}
<section class="upcoming-events">
    <div class="flex-center justify-between">
        <h2>Gestión de Staff</h2>
        <a href="/create-staff" class="a-button-filled-red">Agregar Staff</a>
    </div>
    
    {% if staff_members %}
        <div class="staff-table-container">
            <table class="staff-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Email</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for staff in staff_members %}
                    <tr>
                        <td>{{ staff.id }}</td>
                        <td>{{ staff.first_name }}</td>
                        <td>{{ staff.last_name }}</td>
                        <td>{{ staff.email }}</td>
                        <td class="actions">
                            <a href="/staff/edit/{{ staff.id }}" class="btn-edit" title="Editar">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                                    <path d="m15 5 4 4"/>
                                </svg>
                            </a>
                            <button class="btn-delete" onclick="deleteStaff({{ staff.id }})" title="Eliminar">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 6h18"/>
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                                    <path d="M8 6V4c0-1 1-2 2-2h4c0-1 1-2 2-2v2"/>
                                </svg>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="no-staff">
            <p>No hay staff registrado.</p>
            <a href="/create-staff" class="a-button-filled-red">Agregar primer miembro del staff</a>
        </div>
    {% endif %}
</section>

<style>
.staff-table-container {
    margin-top: 2rem;
    overflow-x: auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.staff-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
}

.staff-table th,
.staff-table td {
    padding: 1rem;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.staff-table th {
    background-color: #f8f9fa;
    font-weight: 600;
    color: #333;
}

.staff-table tbody tr:hover {
    background-color: #f8f9fa;
}

.actions {
    display: flex;
    gap: 0.5rem;
}

.btn-edit,
.btn-delete {
    padding: 0.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: background-color 0.2s;
}

.btn-edit {
    background-color: #007bff;
    color: white;
}

.btn-edit:hover {
    background-color: #0056b3;
}

.btn-delete {
    background-color: #dc3545;
    color: white;
}

.btn-delete:hover {
    background-color: #c82333;
}

.no-staff {
    text-align: center;
    padding: 3rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-top: 2rem;
}

.no-staff p {
    margin-bottom: 1.5rem;
    color: #666;
    font-size: 1.1rem;
}
</style>

<script>
async function deleteStaff(staffId) {
    if (!confirm('¿Estás seguro de que quieres eliminar este miembro del staff? Esta acción no se puede deshacer.')) {
        return;
    }

    try {
        const response = await fetch(`/staff/delete/${staffId}`, {
            method: 'DELETE',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const result = await response.json();
            alert(result.message);
            // Recargar la página para mostrar los cambios
            window.location.reload();
        } else {
            const error = await response.json();
            if (error.redirect) {
                window.location.href = error.redirect;
            } else {
                alert('Error: ' + (error.error || 'Error desconocido'));
            }
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al eliminar el staff. Por favor, inténtalo de nuevo.');
    }
}
</script>
{% endblock main %}